package HashTable.S2_ClassicHashTable;

import java.util.HashMap;
import java.util.Map;

import static Utils.Helpers.log;

/*
 * 4Sum II
 *
 * - ç»™å®š4ä¸ªæ•°ç»„ A, B, C, Dï¼ŒæŸ¥æ‰¾æœ‰å¤šå°‘ i, j, k, l çš„ç»„åˆä½¿å¾— A[i] + B[j] + C[k] + D[l] == 0ã€‚
 *   å…¶ä¸­ A, B, C, D çš„å…ƒç´ ä¸ªæ•° n ç›¸ç­‰ï¼Œä¸” 0 â‰¤ n â‰¤ 500ã€‚è¿”å› i, j, k, l çš„ç»„åˆæ•°ã€‚
 * */

public class L454_4SumII {
    /*
     * è§£æ³•1ï¼šBrute force
     * - æ—¶é—´å¤æ‚åº¦ O(n^4)ï¼Œç©ºé—´å¤æ‚åº¦ O(1)ã€‚
     * */
    public static int fourSumCount(int[] A, int[] B, int[] C, int[] D) {
        int count = 0;
        for (int n : A)
            for (int m : B)
                for (int p : C)
                    for (int q : D)
                        if (n + m + p + q == 0)
                            count++;
        return count;
    }

    /*
     * è§£æ³•2ï¼šæŸ¥æ‰¾è¡¨
     * - æ€è·¯ï¼šğŸ’ å€Ÿé‰´ L18_4Sum çš„æ€è·¯ï¼Œå°†é—®é¢˜è½¬åŒ–ä¸º 3Sumï¼Œå³å…ˆç”¨æŸ¥æ‰¾è¡¨è®°å½•ä¸€ä¸ªæ•°ç»„ï¼ˆä¾‹å¦‚ Dï¼‰çš„æ‰€æœ‰å…ƒç´ ï¼Œä¹‹åé€šè¿‡3å±‚
     *   for å¾ªç¯éå† A, B, C çš„æ‰€æœ‰ç»„åˆï¼Œåœ¨æŸ¥æ‰¾è¡¨ä¸­æœç´¢æ˜¯å¦æœ‰å…ƒç´  l æ»¡è¶³ dMap.get(l) == 0 - A[i] - B[j] - C[k]ã€‚
     *   é€šè¿‡è¿™æ ·æŸ¥æ‰¾ä½¿å¾—æ— éœ€éå†æ•°ç»„ D âˆ´ æ—¶é—´å°†å¤æ‚åº¦ä»è§£æ³•1çš„ O(n^4) é™ä½ä¸º O(n^3)ã€‚
     * - å®ç°ï¼šæ³¨æ„ âˆµ æ•°ç»„ä¸­å¯èƒ½å­˜åœ¨é‡å¤å…ƒç´ ï¼ˆå¦‚ [0,0,1]ï¼‰ï¼Œè€Œæœ¬é¢˜æ˜¯å¯ä»¥ä½¿ç”¨é‡å¤å…ƒç´ çš„ âˆ´ æŸ¥æ‰¾è¡¨éœ€ä½¿ç”¨ Map ç»“æ„è®°å½• {å…ƒç´ : é¢‘æ¬¡}ã€‚
     * - æ—¶é—´å¤æ‚åº¦ O(n^3)ï¼Œç©ºé—´å¤æ‚åº¦ O(n)ã€‚
     * */
    public static int fourSumCount2(int[] A, int[] B, int[] C, int[] D) {
        int count = 0;
        Map<Integer, Integer> map = new HashMap<>();

        for (int d : D)
            map.merge(d, 1, Integer::sum);  // è€ƒè™‘å¯èƒ½æœ‰é‡å¤çš„å…ƒç´  âˆ´ è¦è®°å½•æ¯ä¸ªå…ƒç´ çš„é¢‘æ¬¡

        for (int a : A)
            for (int b : B)
                for (int c : C)
                    count += map.getOrDefault(0 - a - b - c, 0);  // åŠ ä¸Šè¯¥å…ƒç´ çš„å‡ºç°é¢‘æ¬¡

        return count;
    }

    /*
     * è§£æ³•3ï¼šæŸ¥æ‰¾è¡¨ï¼ˆè§£æ³•2çš„è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ŒğŸ¥‡æœ€ä¼˜è§£ï¼‰
     * - çº¿ç´¢ï¼šç”±äºé¢˜ç›®ä¸­è¯´ n â‰¤ 500 âˆ´ éšå«çš„æ¡ä»¶å°±æ˜¯ O(n^2) çº§åˆ«çš„ç®—æ³•æ‰å¯ä»¥æ»¡è¶³æ€§èƒ½è¦æ±‚ï¼ˆè‹¥ O(n^3) åˆ™ä¼šå¾ˆæ…¢ï¼‰ã€‚
     * - æ€è·¯ï¼šğŸ’ è§£æ³•2ä¸­ç”¨æŸ¥æ‰¾è¡¨è®°å½• D[i] çš„æ‰€æœ‰å…ƒç´ ã€‚è‹¥å†è¿›ä¸€æ­¥ï¼Œç”¨æŸ¥æ‰¾è¡¨è®°å½• C[i] + D[j] çš„æ‰€æœ‰ç»„åˆï¼Œåˆ™å¯ä¼˜åŒ–åˆ° O(n^2)ã€‚
     * - å®ç°ï¼šâˆµ n â‰¤ 500 âˆ´ ç”¨ä¸€ä¸ª Map è®°å½• 500^2=250000 ä¸ªé”®å€¼å¯¹æ˜¯å®Œå…¨å¯ä»¥æ¥å—çš„ã€‚
     * - æ—¶é—´å¤æ‚åº¦ O(n^2)ï¼Œç©ºé—´å¤æ‚åº¦ O(n^2)ã€‚
     * - æ€è€ƒï¼šæŸ¥æ‰¾è¡¨çš„æ ¸å¿ƒé—®é¢˜æ˜¯ï¼šæˆ‘ä»¬åˆ°åº•è¦æŸ¥æ‰¾ä»€ä¹ˆï¼Ÿ
     * */
    public static int fourSumCount3(int[] A, int[] B, int[] C, int[] D) {
        int count = 0;
        Map<Integer, Integer> map = new HashMap<>();

        for (int c : C)  // ç”¨æŸ¥æ‰¾è¡¨è®°å½• C[i] + D[j] çš„æ‰€æœ‰ç»„åˆï¼Œå¹¶è®°å½•æ¯ç§ç»„åˆçš„é¢‘æ¬¡
            for (int d : D)
                map.merge(c + d, 1, Integer::sum);

        for (int a : A)  // ä» A[k] + B[l] çš„æ‰€æœ‰ç»„åˆä¸ C[i] + D[j] çš„æ‰€æœ‰ç»„åˆä¸­æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ç»„åˆçš„é¢‘æ¬¡ï¼ŒåŠ åˆ° count ä¸Š
            for (int b : B)
                count += map.getOrDefault(0 - a - b, 0);

        return count;
    }

    public static void main(String[] args) {
        int[] A = {1, 2}, B = {-2, -1}, C = {-1, 2}, D = {0, 2};
        log(fourSumCount3(A, B, C, D));         // expects 2 ([1, -2, -1, 2], [2, -1, -1, 0])

        int[] A2 = {0, 1, -1}, B2 = {-1, 1, 0};
        int[] C2 = {0, 0, 1}, D2 = {-1, 1, 1};  // å…¶ä¸­C2 åŒ…å«å…ƒç´ é‡å¤çš„æƒ…å†µ
        log(fourSumCount3(A2, B2, C2, D2));     // expects 17
    }
}
